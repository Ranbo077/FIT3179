<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Marriage and Divorce Rates Across Australia (2024)</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@6.2.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@6.1.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@7.0.2"></script>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 32px; background:#fafafa; }
    h2 { text-align: center; margin-bottom: 8px; }
    .vis {
      margin: 28px auto;
      width: 100%;
      text-align: center;
    }
    .vis canvas,
    .vis svg {
      margin: 0 auto !important;
      display: block !important;
    }
    .map-container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 30px;
      margin: 28px auto;
      max-width: 980px;
    }
    #map {
      flex-shrink: 0;
    }
    .filter-container {
      margin-top: 50px;
      min-width: 200px;
    }
    .filter-container label {
      font-weight: 600;
      margin-bottom: 8px;
      display: block;
      color: #333;
    }
    .filter-container select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      background: white;
    }
    .dashboard-footer {
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      border-top: 1px solid #e0e0e0;
      background-color: #f9f9f9;
    }
    .dashboard-footer p {
      margin: 0;
      color: #666;
      font-size: 14px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <h2>Marriage and Divorce Rates Across Australia (2024)</h2>
  <div class="map-container">
    <div id="map" class="vis"></div>
    <div class="filter-container">
      <label for="state-select">Select State:</label>
      <select id="state-select">
        <option value="All States">All States</option>
        <option value="New South Wales">New South Wales</option>
        <option value="Victoria">Victoria</option>
        <option value="Queensland">Queensland</option>
        <option value="South Australia">South Australia</option>
        <option value="Western Australia">Western Australia</option>
        <option value="Tasmania">Tasmania</option>
        <option value="Northern Territory">Northern Territory</option>
        <option value="Australian Capital Territory">Australian Capital Territory</option>
      </select>
    </div>
  </div>
  <div id="chart" class="vis"></div>

  <footer class="dashboard-footer">
    <p>This dashboard allows comparison of marriage and divorce rates across Australian states based on ABS 2024 data.</p>
  </footer>

  <script>
    // ---- Week 9 Map (Australia Marriage Rate by State) ----
    const week9Map = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {
        "text": "Australia — Marriage rate by state, 2024",
        "subtitle": "Data Source: ABS Marriages & Divorces 2024 · Unit: per 1,000 people aged 16+"
      },
      "width": 580,
      "height": 420,
      "params": [
        {
          "name": "state_filter",
          "value": "All States"
        }
      ],
      "layer": [
        {
          "data": {
            "graticule": {
              "step": [5, 5],
              "extent": [[110, -45], [160, -10]]
            }
          },
          "mark": {"type": "geoshape", "stroke": "#8fa0a8", "strokeWidth": 0.8, "fill": null, "opacity": 0.9, "clip": true}
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/Ranbo077/FIT3179/main/WEEK9/australia_states.json",
            "format": {"type": "topojson", "feature": "australia_states.json"}
          },
          "transform": [
            {
              "lookup": "properties.name",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/Ranbo077/FIT3179/main/WEEK9/Marriage_and_Divorce_Rates_Per1000_2024.csv"
                },
                "key": "state",
                "fields": [
                  "marriage_rate_per_1000_2024",
                  "divorce_rate_per_1000_2024"
                ]
              }
            },
            {
              "filter": "state_filter == 'All States' || datum['properties.name'] == state_filter"
            }
          ],
          "projection": {"type": "mercator", "center": [133, -28], "scale": 800},
          "mark": {"type": "geoshape", "stroke": "#ffffff", "strokeWidth": 1},
          "encoding": {
            "color": {
              "field": "marriage_rate_per_1000_2024",
              "type": "quantitative",
              "title": "Marriage rate (per 1,000, age 16+)",
              "scale": {"scheme": "blues", "domain": [0, 8], "naColor": "#eeeeee"}
            },
            "tooltip": [
              {"field": "properties.name", "title": "State/Territory"},
              {"field": "marriage_rate_per_1000_2024", "title": "Marriage rate", "format": ".1f"},
              {"field": "divorce_rate_per_1000_2024", "title": "Divorce rate", "format": ".1f"}
            ]
          }
        }
      ],
      "config": {"view": {"stroke": null}, "background": "white", "geoshape": {"invalid": null}}
    };

    // ---- Week 10 Chart (Marriage vs Divorce Rates Comparison) ----
    const week10Chart = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {"text": "Marriage vs Divorce Rates by State, 2024",
                "subtitle": "Data Source: ABS Marriages & Divorces 2024 · Unit: per 1,000 people aged 16+"},
      "data": {
        "url": "https://raw.githubusercontent.com/Ranbo077/FIT3179/main/WEEK9/Marriage_and_Divorce_Rates_Per1000_2024.csv"
      },
      "layer": [
        {
          "params": [
            {"name": "rate_filter", "select": {"type": "point", "fields": ["RateType"], "empty": "all"}, "bind": "legend"}
          ],
          "transform": [
            {"fold": ["marriage_rate_per_1000_2024", "divorce_rate_per_1000_2024"], "as": ["RateType", "Rate"]},
            {"calculate": "datum['State/Territory'] || datum.State || datum.state || datum['State '] || 'Unknown'", "as": "State"},
            {"filter": {"param": "rate_filter"}}
          ],
          "mark": {"type": "bar"},
          "encoding": {
            "x": {"field": "State", "type": "nominal", "title": "State/Territory", "sort": "-y"},
            "xOffset": {"field": "RateType"},
            "y": {"field": "Rate", "type": "quantitative", "title": "Rate per 1,000"},
            "color": {
              "field": "RateType","type": "nominal","title": "Rate Type",
              "scale": {"domain": ["marriage_rate_per_1000_2024","divorce_rate_per_1000_2024"], "range": ["#1f77b4","#ff7f0e"]}
            },
            "tooltip": [
              {"field": "State", "title": "State"},
              {"field": "RateType", "title": "Type"},
              {"field": "Rate", "title": "Rate per 1,000", "format": ".1f"}
            ]
          }
        },
        {"mark": {"type": "rule", "color": "red", "strokeDash": [4, 2]}, "encoding": {"y": {"datum": 5.5}}},
        {"mark": {"type": "text", "align": "left", "dx": 5, "dy": -5, "color": "red"}, "encoding": {"y": {"datum": 5.5}, "text": {"value": "National Avg ≈ 5.5"}}}
      ],
      "width": 720,
      "height": 480
    };

    // Render both visualizations
    let mapView;

    vegaEmbed("#map", week9Map, {
      actions: false,
      renderer: "svg"
    }).then(result => {
      mapView = result.view;
    });

    vegaEmbed("#chart", week10Chart, {
      actions: false,
      renderer: "svg"
    });

    // Add custom filter control
    document.getElementById('state-select').addEventListener('change', function(event) {
      const selectedState = event.target.value;
      if (mapView) {
        mapView.signal('state_filter', selectedState).run();
      }
    });
  </script>
</body>
</html>
