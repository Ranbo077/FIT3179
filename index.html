<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>FIT3179 Week 9 & 10</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@6.2.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@6.1.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@7.0.2"></script>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 32px; background:#fafafa; }
    h2 { text-align: center; margin-bottom: 8px; }
    .vis {
      margin: 28px auto;
      width: 100%;
      text-align: center;
    }
    .vis canvas,
    .vis svg {
      margin: 0 auto !important;
      display: block !important;
    }
  </style>
</head>
<body>
  <h2>FIT3179 Week 9 & 10 Visualisations</h2>
  <div id="map" class="vis"></div>
  <div id="chart" class="vis"></div>

  <script>
    // ---- Week 9 Map (Australia Marriage Rate by State) ----
    const week9Map = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {
        "text": "Australia — Marriage rate by state, 2024",
        "subtitle": "ABS Marriages & Divorces 2024 · unit: per 1,000 (age 16+)"
      },
      "width": 720,
      "height": 520,
      "layer": [
        {
          "data": {"graticule": {"step": [15, 15]}},
          "mark": {"type": "geoshape", "stroke": "#dbe3ea", "strokeWidth": 0.6, "fill": null, "opacity": 0.7, "clip": true}
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/Ranbo077/FIT3179/main/WEEK9/australia_states.json",
            "format": {"type": "topojson", "feature": "australia_states.json"}
          },
          "transform": [
            {
              "lookup": "properties.name",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/Ranbo077/FIT3179/main/WEEK9/Marriage_and_Divorce_Rates_Per1000_2024.csv"
                },
                "key": "state",
                "fields": [
                  "marriage_rate_per_1000_2024",
                  "divorce_rate_per_1000_2024"
                ]
              }
            }
          ],
          "projection": {"type": "mercator", "center": [133, -28], "scale": 900},
          "mark": {"type": "geoshape", "stroke": "#ffffff", "strokeWidth": 1},
          "encoding": {
            "color": {
              "field": "marriage_rate_per_1000_2024",
              "type": "quantitative",
              "title": "Marriage rate (per 1,000, age 16+)",
              "scale": {"scheme": "blues", "domain": [0, 8], "naColor": "#eeeeee"}
            },
            "tooltip": [
              {"field": "properties.name", "title": "State/Territory"},
              {"field": "marriage_rate_per_1000_2024", "title": "Marriage rate", "format": ".1f"},
              {"field": "divorce_rate_per_1000_2024", "title": "Divorce rate", "format": ".1f"}
            ]
          }
        }
      ],
      "config": {"view": {"stroke": null}, "background": "white", "geoshape": {"invalid": null}}
    };

    // ---- Week 10 Chart (Marriage vs Divorce Rates Comparison) ----
    const week10Chart = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "title": {"text": "Marriage vs Divorce Rates by State, 2024",
                "subtitle": "ABS Marriages & Divorces 2024 · unit: per 1,000 (age 16+)"},
      "data": {
        "url": "https://raw.githubusercontent.com/Ranbo077/FIT3179/main/WEEK9/Marriage_and_Divorce_Rates_Per1000_2024.csv"
      },
      "layer": [
        {
          "params": [
            {"name": "rate_filter", "select": {"type": "point", "fields": ["RateType"], "empty": "all"}, "bind": "legend"}
          ],
          "transform": [
            {"fold": ["marriage_rate_per_1000_2024", "divorce_rate_per_1000_2024"], "as": ["RateType", "Rate"]},
            {"calculate": "datum['State/Territory'] || datum.State || datum.state || datum['State '] || 'Unknown'", "as": "State"},
            {"filter": {"param": "rate_filter"}}
          ],
          "mark": {"type": "bar"},
          "encoding": {
            "x": {"field": "State", "type": "nominal", "title": "State/Territory", "sort": "-y"},
            "xOffset": {"field": "RateType"},
            "y": {"field": "Rate", "type": "quantitative", "title": "Rate per 1,000"},
            "color": {
              "field": "RateType","type": "nominal","title": "Rate Type",
              "scale": {"domain": ["marriage_rate_per_1000_2024","divorce_rate_per_1000_2024"], "range": ["#1f77b4","#ff7f0e"]}
            },
            "tooltip": [
              {"field": "State", "title": "State"},
              {"field": "RateType", "title": "Type"},
              {"field": "Rate", "title": "Rate per 1,000", "format": ".1f"}
            ]
          }
        },
        {"mark": {"type": "rule", "color": "red", "strokeDash": [4, 2]}, "encoding": {"y": {"datum": 5.5}}},
        {"mark": {"type": "text", "align": "left", "dx": 5, "dy": -5, "color": "red"}, "encoding": {"y": {"datum": 5.5}, "text": {"value": "National Avg ≈ 5.5"}}}
      ],
      "width": 720,
      "height": 480
    };

    // Render both visualizations with center alignment
    vegaEmbed("#map", week9Map, {
      actions: false,
      renderer: "svg"
    }).then(result => {
      // Center the visualization
      const container = document.getElementById("map");
      container.style.display = "flex";
      container.style.justifyContent = "center";
    });

    vegaEmbed("#chart", week10Chart, {
      actions: false,
      renderer: "svg"
    }).then(result => {
      // Center the visualization
      const container = document.getElementById("chart");
      container.style.display = "flex";
      container.style.justifyContent = "center";
    });
  </script>
</body>
</html>
